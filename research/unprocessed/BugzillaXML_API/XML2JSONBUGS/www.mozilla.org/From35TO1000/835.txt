{"bugs":[{"creation_time":"Fri Sep 18 06:55:53 EEST 1998","keywords":[],"is_cc_accessible":true,"flags":[],"whiteboard":"","see_also":[],"resolution":"FIXED","platform":"x86","cf_fx_points":"---","cf_fx_iteration":"---","id":835,"assigned_to":"ftang@formerly-netscape.com.tld","cc":[],"summary":"META description causes assertion failure in the RDF module","severity":"normal","creator":"bratell@lysator.liu.se","product":"MozillaClassic","depends_on":[],"is_open":false,"blocks":[],"is_confirmed":true,"cf_qa_whiteboard":"","groups":[],"assigned_to_detail":{"name":"ftang@formerly-netscape.com.tld","real_name":"Frank Tang","id":1904,"email":"ftang@formerly-netscape.com.tld"},"creator_detail":{"name":"bratell@lysator.liu.se","real_name":"Daniel Bratell","id":1749,"email":"bratell@lysator.liu.se"},"priority":"P2","classification":"Graveyard","cf_last_resolved":"Wed Sep 30 10:29:23 EEST 1998","version":"other","url":"http://c245.ryd.student.liu.se/~bratell/mozillabug1.html","qa_contact":"rubydoo123@aol.com","op_sys":"Windows NT","last_change_time":"Wed Apr 21 18:23:15 EEST 1999","target_milestone":"---","component":"Aurora/RDF BE","is_creator_accessible":true,"cc_detail":[],"mentors":[],"mentors_detail":[],"cf_user_story":"","qa_contact_detail":{"name":"rubydoo123@aol.com","real_name":"","id":3849,"email":"rubydoo123@aol.com"},"status":"VERIFIED"}],"comments":[{"is_private":false,"creation_time":"Fri Sep 18 06:55:53 EEST 1998","creator":"bratell@lysator.liu.se","author":"bratell@lysator.liu.se","time":"Fri Sep 18 06:55:53 EEST 1998","text":"When trying to browse some pages I got a lot of assertion failures in the rdf modules so I stripped the source code of those pages as much as possible and found that the tag: <meta name=\"description\" content=\"Foo\"> caused it but only when visiting certain domains. For instance, you get the failures at http://c245.ryd.student.liu.se/mozillabug1.html and at http://www.student.liu.se/ but not at http://www.lysator.liu.se/~bratell/ which has a copy of the page at c245.ryd.student.liu.se.  What I get is assertion failures at /mozilla/modules/rdf/src/mcf.c line 321, /mozilla/modules/rdf/src/nlcstore.c line 328  or  assertion failures at /mozilla/modules/rdf/src/nlcstore.c line 371, /mozilla/modules/rdf/src/mcf.c line 631  I didn't manage to get a stack trace since I was using a nightly build (19980917), but maybe you can reproduce it yourself. Since this might be caused by some I18n stuff, I should tell you that I have a Swedish system (character set latin-1)","id":3204,"bug_id":835,"tags":[]},{"is_private":false,"creation_time":"Fri Sep 25 17:03:59 EEST 1998","creator":"mozilla@rjcdb.com","author":"mozilla@rjcdb.com","time":"Fri Sep 25 17:03:59 EEST 1998","text":"Frank, please take a look at this, its almost certainly a UTF8 issue.","id":3205,"bug_id":835,"tags":[]},{"is_private":false,"creation_time":"Tue Sep 29 18:21:59 EEST 1998","creator":"ftang@formerly-netscape.com.tld","author":"ftang@formerly-netscape.com.tld","time":"Tue Sep 29 18:21:59 EEST 1998","text":"The problem is in ht.c HT_LayoutComplete routine. That routine have several problem. First of all, it does not convert content into UTF8 from the win_csid before it passed to RDF_Assert. Second, it call the PA_FetchParamValue with a BAD CAST. The second parameter should be a win_csid, which should be get back from a INTL_CharSetInfo object. The INTL_CharSetInfo object it self is not a csid. So... the program should do...  INTL_CharSetInfo intl_csi; /* don't named it csid to confuse yourself */ .... intl_csi = LO_GetDocumentCharacterSetInfo(context); int16 wincsid = INTL_GetCSIWinCSID(intl_csi); ....  name = PA_FetchParamValue(metaList, \"name\", wincsid); content = PA_FetchParamValue(metaList, \"content\", wincsid);  ... then you need to convert content into UTF8 by calling char* contentInUTF8 = INTL_ConvertLineWithoutAutoDetect(wincsid, CS_UTF8, content, XP_STRLEN(content);  You may need to do XP_FREE contentInUTF8 if you no longer need it.  Cast a INTL_CharSetInfo object into uint16 and pass it into PA_FetchParamValue is a very bad practice of programming. (I don't know who origionally write the code like that. )","id":3206,"bug_id":835,"tags":[]},{"is_private":false,"creation_time":"Tue Sep 29 19:52:59 EEST 1998","creator":"ftang@formerly-netscape.com.tld","author":"ftang@formerly-netscape.com.tld","time":"Tue Sep 29 19:52:59 EEST 1998","text":"Make it clear: <meta name=\"description\" content=\"Foo\"> won't cause assert. <meta name=\"description\" content=\"someLatinAccentCharacter\"> will.....","id":3207,"bug_id":835,"tags":[]},{"is_private":false,"creation_time":"Tue Sep 29 19:58:59 EEST 1998","creator":"ftang@formerly-netscape.com.tld","author":"ftang@formerly-netscape.com.tld","time":"Tue Sep 29 19:58:59 EEST 1998","text":"Bugzilla bug 835  OK, the fix have been push to http://peoplestage.netscape.com/ftang/patches/ht.c.diff.txt and it should be accessabled from outside as http://people.netscape.com/ftang/patches/ht.c.diff.txt when it got push.  rjc, could you grant me check in right ? Thanks.","id":3208,"bug_id":835,"tags":[]},{"is_private":false,"creation_time":"Wed Sep 30 10:29:59 EEST 1998","creator":"ftang@formerly-netscape.com.tld","author":"ftang@formerly-netscape.com.tld","time":"Wed Sep 30 10:29:59 EEST 1998","text":"the fix get check in into modules/rdf/src/ht.c rev 3.75","id":3209,"bug_id":835,"tags":[]},{"is_private":false,"creation_time":"Wed Feb 03 19:00:59 EET 1999","creator":"glynn@formerly-netscape.com.tld","author":"glynn@formerly-netscape.com.tld","time":"Wed Feb 03 19:00:59 EET 1999","text":"Old code base, ftang is this still valid?  Set beppe@netscape.com for qa contact","id":3210,"bug_id":835,"tags":[]},{"is_private":false,"creation_time":"Tue Feb 16 18:20:59 EET 1999","creator":"rubydoo123@aol.com","author":"rubydoo123@aol.com","time":"Tue Feb 16 18:20:59 EET 1999","text":"above URL is not a valid path, presuming fix is good.","id":3211,"bug_id":835,"tags":[]}]}
