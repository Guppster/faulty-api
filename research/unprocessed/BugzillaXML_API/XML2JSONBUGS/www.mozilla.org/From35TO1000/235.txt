{"bugs":[{"creation_time":"Thu Apr 16 06:01:59 EEST 1998","keywords":[],"see_also":[],"resolution":"FIXED","cf_blocking_fx":"---","cf_fx_iteration":"---","cf_blocking_b2g":"---","cf_status_b2g_1_4":"---","id":235,"is_open":false,"cf_qa_whiteboard":"","assigned_to_detail":{"name":"wtc@google.com","real_name":"Wan-Teh Chang","id":1584,"email":"wtc@google.com"},"creator_detail":{"name":"driehuis@playbeing.org","real_name":"Bert Driehuis","id":1717,"email":"driehuis@playbeing.org"},"cf_status_firefox37":"---","priority":"P3","cf_status_firefox36":"---","classification":"Components","cf_status_firefox35":"---","version":"other","cf_status_firefox34":"---","op_sys":"BSDI","last_change_time":"Mon Jan 13 01:42:23 EET 2003","cf_crash_signature":"","mentors_detail":[],"cf_tracking_b2g":"---","cf_status_b2g_2_0m":"---","status":"VERIFIED","is_cc_accessible":true,"cf_tracking_firefox37":"---","cf_tracking_firefox36":"---","cf_tracking_relnote_b2g":"---","flags":[],"cf_status_firefox_esr31":"---","whiteboard":"","platform":"Other","cf_tracking_firefox_esr31":"---","cf_blocking_fennec":"---","cf_fx_points":"---","cf_tracking_firefox35":"---","cf_tracking_firefox34":"---","cf_status_b2g_2_2":"---","cf_status_b2g_2_1":"---","cf_status_b2g_2_0":"---","assigned_to":"wtc@google.com","summary":"PRNetAddr doesn't match sockaddr_in","cf_tracking_e10s":"---","cc":[],"severity":"normal","creator":"driehuis@playbeing.org","product":"NSPR","depends_on":[],"cf_tracking_firefox_relnote":"---","blocks":[],"is_confirmed":true,"groups":[],"cf_last_resolved":"Sat Jan 06 06:01:09 EET 2001","url":"","qa_contact":"","target_milestone":"---","component":"NSPR","is_creator_accessible":true,"cc_detail":[],"mentors":[],"cf_user_story":""}],"comments":[{"is_private":false,"creation_time":"Thu Apr 16 06:01:59 EEST 1998","creator":"driehuis@playbeing.org","author":"driehuis@playbeing.org","time":"Thu Apr 16 06:01:59 EEST 1998","text":"Created by Bert Driehuis (driehuis@playbeing.org) on Wednesday, April 15, 1998 4:01:59 PM PDT Additional Details : Building Mozilla 1998-04-08 fails on BSD/OS 3.0. On investigation, the definition of PRNetAddr (which is cast into a sockaddr_in in ns/nsprpub/src/md/unix/unix.c in the MD_connect routine) turns out to use a short in host order for the sin_family field. BSD/OS 3.0 (and I'd imagine all 4.4lite2 derived unixes, but I haven't checked) define this field as  u_char sa_len;  u_char sa_family; which happens to be byte-swapped w.r.t. the assumptions in ns/nsprpub/include/prio.h, where these two bytes are addressed as one PRUint16.  This needs to be addressed, probably in ns/nsprpub/src/md/unix/unix.c, by filling in a sockaddr_in from the PRNetAddr structure, before performing the connect.  I haven't provided a fix, since I'm not positive about the proper way of fixing it. I'll see if I can come up with a solution that works with BSD/OS 3.0 without obviously breaking ports on which casting to sockaddr_in works. Updated by Bert Driehuis (driehuis@playbeing.org) on Wednesday, April 15, 1998 4:35:06 PM PDT Additional Details : This patch gets the BSDI 3.0 version working:  *** nsprpub/pr/src/md/unix/unix.c.dist  Thu Apr  9 02:52:30 1998 --- nsprpub/pr/src/md/unix/unix.c       Thu Apr 16 01:21:47 1998 *************** *** 1062,1065 **** --- 1062,1072 ----         PRThread *me = _PR_MD_CURRENT_THREAD();       PRInt32 osfd = fd->secret->md.osfd; + #ifdef __bsdi__ +       struct sockaddr the_addr; +       the_addr = *((struct sockaddr *)addr); +       the_addr.sa_len = sizeof(the_addr); +       the_addr.sa_family = addr->inet.family; +       addr = (PRNetAddr *) &the_addr; + #endif   #ifdef IRIX   extern PRInt32 _MD_irix_connect( *************** *** 2317,2321 ****                 osflags |= O_TRUNC;         if (flags & PR_SYNC) { ! #if defined(FREEBSD)                 osflags |= O_FSYNC;   #else --- 2324,2328 ----                 osflags |= O_TRUNC;         if (flags & PR_SYNC) { ! #if defined(FREEBSD) || defined(__bsdi__)                 osflags |= O_FSYNC;   #else  (the FreeBSD/BSDI fix could probably have been avoided by conditionalizing on BS D44LITE2 or something like that, that would help NetBSD as well, I guess).  Are there any systems that Mozilla runs on that don't define sa_len?  I could unfortunately not update my report using Mozilla 1998-04-08 because of apparent JavaScript lossage (\"try again: you didn't specify a short description). Fortunately, 4.04 works just fine :-) Updated by Wan-Teh Chang (wtc@netscape.com) on Wednesday, May 6, 1998 8:02:09 PM PDT Additional Details : Assigned bug to myself.  The O_FSYNC bug has been fixed.  I will look at the sockaddr_in.sa_len bug. Updated by Wan-Teh Chang (wtc@netscape.com) on Thursday, May 7, 1998 8:56:24 AM PDT Additional Details : I just fixed the sockaddr_in.sa_len problem in mozilla/nsprpub/pr/include/md/_bsdi.h, revision 3.2, in conjunction with a prior fix to mozilla/nsprpub/pr/src/md/unix.c.  I define the macro _PR_HAVE_SOCKADDR_LEN in _bsdi.h. (This macro is also defined for _aix.h, _freebsd.h, and _rhapsody.h, indicating their BSD4.4 heritage.) The code in unix.c checks the _PR_HAVE_SOCKADDR_LEN macro and does the appropriate things.  I ran a few socket tests (in mozilla/nsprpub/pr/tests) on our BSD/OS 2.1 and 3.0 machines and they all pased.  Closed the bug.  PS: To answer your question, yes, there are platforms that do not have a length field in their sockaddr, e.g., Solaris.","id":459,"bug_id":235,"tags":[]},{"is_private":false,"creation_time":"Tue Apr 27 18:00:59 EEST 1999","creator":"terry@mozilla.org","author":"terry@mozilla.org","time":"Tue Apr 27 18:00:59 EEST 1999","text":"NSPR now has its own Bugzilla product.  Moving this bug to the NSPR product.","id":460,"bug_id":235,"tags":[]},{"is_private":false,"creation_time":"Sat Jan 06 05:59:35 EET 2001","creator":"jruderman@gmail.com","author":"jruderman@gmail.com","time":"Sat Jan 06 05:59:35 EET 2001","text":"these bugs are closed but have no resolution.  reopening...","id":553930,"bug_id":235,"tags":[]},{"is_private":false,"creation_time":"Sat Jan 06 06:01:09 EET 2001","creator":"jruderman@gmail.com","author":"jruderman@gmail.com","time":"Sat Jan 06 06:01:09 EET 2001","text":"marking as fixed.","id":553949,"bug_id":235,"tags":[]},{"is_private":false,"creation_time":"Mon Jan 13 01:42:23 EET 2003","creator":"brant@gurganus.name","author":"brant@gurganus.name","time":"Mon Jan 13 01:42:23 EET 2003","text":"VERIFIED due to no changes in over a year","id":1707252,"bug_id":235,"tags":[]}]}
