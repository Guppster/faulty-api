{"bugs":[{"creation_time":"Thu May 14 08:20:07 EEST 1998","keywords":[],"see_also":[],"resolution":"FIXED","cf_blocking_fx":"---","cf_fx_iteration":"---","cf_blocking_b2g":"---","cf_status_b2g_1_4":"---","id":350,"is_open":false,"cf_qa_whiteboard":"","assigned_to_detail":{"name":"nelson@bolyard.me","real_name":"Nelson Bolyard (seldom reads bugmail)","id":4484,"email":"nelson@bolyard.me"},"creator_detail":{"name":"wtc@google.com","real_name":"Wan-Teh Chang","id":1584,"email":"wtc@google.com"},"cf_status_firefox37":"---","priority":"P3","cf_status_firefox36":"---","classification":"Components","cf_status_firefox35":"---","version":"other","cf_status_firefox34":"---","op_sys":"All","last_change_time":"Fri May 15 05:40:36 EEST 2009","cf_crash_signature":"","mentors_detail":[],"cf_tracking_b2g":"---","cf_status_b2g_2_0m":"---","status":"RESOLVED","is_cc_accessible":true,"cf_tracking_firefox37":"---","cf_tracking_firefox36":"---","cf_tracking_relnote_b2g":"---","flags":[],"cf_status_firefox_esr31":"---","whiteboard":"","platform":"All","cf_tracking_firefox_esr31":"---","cf_blocking_fennec":"---","cf_fx_points":"---","cf_tracking_firefox35":"---","cf_tracking_firefox34":"---","cf_status_b2g_2_2":"---","cf_status_b2g_2_1":"---","cf_status_b2g_2_0":"---","assigned_to":"nelson@bolyard.me","summary":"PR_ExplodeTime() works only if given a PRTime argument between year 1901-2099","cf_tracking_e10s":"---","cc":["bugzilla@tuxmachine.com","creidieki+mozbugs@gmail.com","julien.pierre@oracle.com","kaie@kuix.de","karl@huftis.org","martijn.martijn@gmail.com","matthijs.wensveen@gmail.com","philipp@bugzilla.kewis.ch","piskozub@iopan.gda.pl","raj@lordofthemoon.com","reed@reedloden.com","ryanvm@gmail.com","samuel@sieb.net","shanmus@gmail.com","sluggo@unknown.nu","ssitter@gmail.com","wladow@gmail.com","wtc@google.com"],"severity":"minor","creator":"wtc@google.com","product":"NSPR","depends_on":[],"cf_tracking_firefox_relnote":"---","blocks":[391038,238632],"is_confirmed":true,"groups":[],"cf_last_resolved":"Mon Feb 09 20:08:46 EET 2009","url":"","qa_contact":"","target_milestone":"4.8","component":"NSPR","is_creator_accessible":true,"cc_detail":[{"name":"bugzilla@tuxmachine.com","real_name":"Jeremy Baron","id":205514,"email":"bugzilla@tuxmachine.com"},{"name":"creidieki+mozbugs@gmail.com","real_name":"M. Creidieki Crouch","id":95366,"email":"creidieki+mozbugs@gmail.com"},{"name":"julien.pierre@oracle.com","real_name":"Julien Pierre","id":15546,"email":"julien.pierre@oracle.com"},{"name":"kaie@kuix.de","real_name":"Kai Engert (:kaie)","id":36541,"email":"kaie@kuix.de"},{"name":"karl@huftis.org","real_name":"Karl Ove 'I hate marquee' Hufthammer","id":6573,"email":"karl@huftis.org"},{"name":"martijn.martijn@gmail.com","real_name":"Martijn Wargers [:mwargers] (QA)","id":55600,"email":"martijn.martijn@gmail.com"},{"name":"matthijs.wensveen@gmail.com","real_name":"Matthijs Wensveen","id":63386,"email":"matthijs.wensveen@gmail.com"},{"name":"philipp@bugzilla.kewis.ch","real_name":"Philipp Kewisch [:Fallen]","id":253233,"email":"philipp@bugzilla.kewis.ch"},{"name":"piskozub@iopan.gda.pl","real_name":"Jacek Piskozub","id":22464,"email":"piskozub@iopan.gda.pl"},{"name":"raj@lordofthemoon.com","real_name":"Raj Bhaskar","id":26375,"email":"raj@lordofthemoon.com"},{"name":"reed@reedloden.com","real_name":"Reed Loden [:reed]","id":159758,"email":"reed@reedloden.com"},{"name":"ryanvm@gmail.com","real_name":"[Away 24-Dec to 4-Jan] Ryan VanderMeulen [:RyanVM UTC-5]","id":75935,"email":"ryanvm@gmail.com"},{"name":"samuel@sieb.net","real_name":"Samuel Sieb","id":14762,"email":"samuel@sieb.net"},{"name":"shanmus@gmail.com","real_name":"Shanmu","id":93445,"email":"shanmus@gmail.com"},{"name":"sluggo@unknown.nu","real_name":"Kim Scarborough","id":37932,"email":"sluggo@unknown.nu"},{"name":"ssitter@gmail.com","real_name":"Stefan Sitter","id":217783,"email":"ssitter@gmail.com"},{"name":"wladow@gmail.com","real_name":"Vlado Valastiak [:wladow] @ Mozilla.sk","id":228076,"email":"wladow@gmail.com"},{"name":"wtc@google.com","real_name":"Wan-Teh Chang","id":1584,"email":"wtc@google.com"}],"mentors":[],"cf_user_story":""}],"comments":[{"is_private":false,"creation_time":"Thu May 14 08:20:07 EEST 1998","creator":"wtc@google.com","author":"wtc@google.com","time":"Thu May 14 08:20:07 EEST 1998","text":"Created by Wan-Teh Chang (wtc@netscape.com) on Wednesday, May 13, 1998 6:20:07 PM PDT Additional Details : This problem is first reported by Christopher Shaulis <cjs2895@la-paz.org> in the netscape.public.mozilla.general newsgroup.  He noticed a comment in mozilla/nsprpub/pr/src/misc/prtime.c saying that the leap-year calculation used in ComputeGMT() is only correct for 1901-2099.  ComputeGMT() is an internal function used by PR_ExplodeTIme().  This means that PR_ExplodeTime returns an incorrect result if given a PRTime value that represents a date before 1900 or after 2100. Updated by Wan-Teh Chang (wtc@netscape.com) on Wednesday, May 13, 1998 6:21:33 PM PDT Additional Details : Marked the bug assigned with priority P5.","id":882,"bug_id":350,"tags":[]},{"is_private":false,"creation_time":"Sat Mar 06 07:10:59 EET 1999","creator":"paulmac@formerly-netscape.com.tld","author":"paulmac@formerly-netscape.com.tld","time":"Sat Mar 06 07:10:59 EET 1999","text":"per leger, assigning QA contacts to all open bugs without QA contacts according to list at http://bugzilla.mozilla.org/describecomponents.cgi?product=Browser","id":883,"bug_id":350,"tags":[]},{"is_private":false,"creation_time":"Tue Apr 27 18:00:59 EEST 1999","creator":"terry@mozilla.org","author":"terry@mozilla.org","time":"Tue Apr 27 18:00:59 EEST 1999","text":"NSPR now has its own Bugzilla product.  Moving this bug to the NSPR product.","id":884,"bug_id":350,"tags":[]},{"is_private":false,"creation_time":"Tue Nov 30 20:33:59 EET 1999","creator":"paulmac@formerly-netscape.com.tld","author":"paulmac@formerly-netscape.com.tld","time":"Tue Nov 30 20:33:59 EET 1999","text":"phillip gone, removing him from qa contact, sorry for spam","id":885,"bug_id":350,"tags":[]},{"is_private":false,"creation_time":"Thu Mar 21 18:51:12 EET 2002","creator":"basic@mozdev.org","author":"basic@mozdev.org","time":"Thu Mar 21 18:51:12 EET 2002","text":"remove self","id":1235801,"bug_id":350,"tags":[]},{"is_private":false,"creation_time":"Wed Sep 04 07:52:17 EEST 2002","creator":"a_lei@chinaren.com","author":"a_lei@chinaren.com","time":"Wed Sep 04 07:52:17 EEST 2002","text":"dfsgdfsgdg","id":1526279,"bug_id":350,"tags":[]},{"is_private":false,"creation_time":"Wed Feb 05 10:54:17 EET 2003","creator":"heyhohar@netscape.net","author":"heyhohar@netscape.net","attachment_id":113577,"time":"Wed Feb 05 10:54:17 EET 2003","text":"Created attachment 113577 test","id":1734589,"bug_id":350,"tags":[]},{"is_private":false,"creation_time":"Wed Jul 14 02:11:34 EEST 2004","creator":"siu_lip@yahoo.com","author":"siu_lip@yahoo.com","time":"Wed Jul 14 02:11:34 EEST 2004","text":"test","id":2202618,"bug_id":350,"tags":[]},{"is_private":false,"creation_time":"Thu Aug 11 10:09:47 EEST 2005","creator":"waynefan@truetel.com","author":"waynefan@truetel.com","time":"Thu Aug 11 10:09:47 EEST 2005","text":"&#28204;&#35430;&#20013;&#25991;&#39023;&#31034;","id":2578275,"bug_id":350,"tags":[]},{"is_private":false,"creation_time":"Sat Aug 27 16:39:57 EEST 2005","creator":"wtc@google.com","author":"wtc@google.com","time":"Sat Aug 27 16:39:57 EEST 2005","text":"Shanmu, since you are working on the related bug 164070, would you like to take a stab at this bug, too?","id":2593284,"bug_id":350,"tags":[]},{"is_private":false,"creation_time":"Tue Aug 30 06:43:41 EEST 2005","creator":"cavallaros@libero.com.au","author":"cavallaros@libero.com.au","time":"Tue Aug 30 06:43:41 EEST 2005","text":"test","id":2595167,"bug_id":350,"tags":[]},{"is_private":false,"creation_time":"Thu Nov 24 07:48:51 EET 2005","creator":"piskozub@iopan.gda.pl","author":"piskozub@iopan.gda.pl","time":"Thu Nov 24 07:48:51 EET 2005","text":"This is the oldest surviving bug on the database.  Have a nice Thanksgiving!","id":2706670,"bug_id":350,"tags":[]},{"is_private":false,"creation_time":"Sat Nov 26 07:00:09 EET 2005","creator":"samuel@sieb.net","author":"samuel@sieb.net","time":"Sat Nov 26 07:00:09 EET 2005","text":"I'll take this, I have a patch.","id":2707701,"bug_id":350,"tags":[]},{"is_private":false,"creation_time":"Sat Nov 26 07:02:10 EET 2005","creator":"samuel@sieb.net","author":"samuel@sieb.net","attachment_id":204200,"time":"Sat Nov 26 07:02:10 EET 2005","text":"Created attachment 204200 can handle any year from 1 to whatever","id":2707702,"bug_id":350,"tags":[]},{"is_private":false,"creation_time":"Thu Jul 06 22:26:42 EEST 2006","creator":"martijn.martijn@gmail.com","author":"martijn.martijn@gmail.com","time":"Thu Jul 06 22:26:42 EEST 2006","text":"Wan-Teh, any chance you could review the patch in the nearby future?","id":2903710,"bug_id":350,"tags":[]},{"is_private":false,"creation_time":"Sun Sep 02 16:49:02 EEST 2007","creator":"samuel@sieb.net","author":"samuel@sieb.net","time":"Sun Sep 02 16:49:02 EEST 2007","text":"Is there anyone else that can review this patch?","id":3299583,"bug_id":350,"tags":[]},{"is_private":false,"creation_time":"Mon Sep 03 18:32:45 EEST 2007","creator":"wtc@google.com","author":"wtc@google.com","attachment_id":204200,"time":"Mon Sep 03 18:32:45 EEST 2007","text":"Comment on attachment 204200 can handle any year from 1 to whatever  r=wtc.  Thank you for the patch, Samuel, and I'm terribly sorry that this fell through the cracks for almost two years.  Nelson, you're welcome to review this patch, but you can also cancel the review request.  I have some suggested changes to improve the patch.  >+    numDays += 719162;       /* days up to 1970 */  The comment should note the beginning of the range of years.  I was wondering whether it was from 1900 or 0. It turns out to be from 1 -- 719162 is the number of days in years 1-1969.  If we ignore the fact that year 0 didn't exist for now, the choice of 1 as the beginning of range is important, because it makes the exceptions for 4-year, 100-year, and 400-year periods happen at the ends.  This allows us to use / and % easily.  >+    gmt->tm_year = tmp * 400;  This can be written as        gmt->tm_year = tmp * 400 + 1;  to eliminate the off-by-one issue.  1 is the beginning of your range (see above), so it makes sense to see 1 there.  (Cf. tmp = (tmp * 4) + 1970; in the original code.)  Note: we could choose any year 400*k + 1 as the beginning of our range.  I guess this must be one of the reasons why Windows' time epoch is January 1, 1601.  >+    if (rem >= 365) { >         tmp++; >         rem -= 365; >-        if (rem >= 365) {                        /* 1972, etc. */ >+        if (rem >= 365) { >             tmp++; >             rem -= 365; >-            if (rem >= 366) {                        /* 1973, etc. */ >+            if (rem >= 365) { >                 tmp++; >-                rem -= 366; >-            } else { >-                isLeap = 1; >+                rem -= 365; >             } >         } >     }  Since the exception (leap year) now happens at the end of the 4-year period, we can use / and % and handle the exception like this (assuming we take care of the off-by-one issue as I suggested above):      tmp = rem % 365;     rem %= 365;     if (tmp == 4) {         tmp = 3;         rem = 365;     }  I also wanted to note that the code you removed:  -    if (rem < 0) { -        tmp--; -        rem += (4 * 365 + 1); -    }  was intended to handle a negative numDays.  In your patch, numDays is only negative if the year was B.C.  But that's already outside the range of years in which our formula is valid.","id":3300625,"bug_id":350,"tags":[]},{"is_private":false,"creation_time":"Mon Sep 03 19:00:00 EEST 2007","creator":"wtc@google.com","author":"wtc@google.com","attachment_id":279492,"time":"Mon Sep 03 19:00:00 EEST 2007","text":"Created attachment 279492 can handle any year from 1 to whatever, v2  Samuel, please let me know if you agree with the changes I made.  Could you also test this version of your patch?  Thanks.","id":3300653,"bug_id":350,"tags":[]},{"is_private":false,"creation_time":"Tue Sep 04 19:37:23 EEST 2007","creator":"nelson@bolyard.me","author":"nelson@bolyard.me","attachment_id":279492,"time":"Tue Sep 04 19:37:23 EEST 2007","text":"Comment on attachment 279492 can handle any year from 1 to whatever, v2  r=nelson.  This looks correct, although I haven't tested it. I'd like to see a few more-or-less cosmetic changes.  1) The variable numDays changes its definition in the middle of  the function.  Initially it is the number of days since some relatively  recent date (Jan 1, 1970?), but then it changes in the middle of the function when  a large constant is added to it. I'd like to see comments stating the definition of day 0 at the declaration, and again at the  point where it is changed.  e.g. something like: \"Day 0 is Jan 1, year 1\" or whatever is correct. This will help future reviewers.  (too late for me, this time :)  2) I'd like to see the expression \"4 * 365 + 1\" disappear from this code. Either replace it with a decimal constant and a comment explaining what that number is (as is done in numerous other places in the code), or  declare a static const variable and initialize it with this expression, and then use that variable name in place of this expression.","id":3301716,"bug_id":350,"tags":[]},{"is_private":false,"creation_time":"Sat Jan 05 21:50:40 EET 2008","creator":"ryanvm@gmail.com","author":"ryanvm@gmail.com","time":"Sat Jan 05 21:50:40 EET 2008","text":"wtc, is this still on the radar?","id":3427009,"bug_id":350,"tags":[]},{"is_private":false,"creation_time":"Wed Feb 06 23:19:54 EET 2008","creator":"reed@reedloden.com","author":"reed@reedloden.com","time":"Wed Feb 06 23:19:54 EET 2008","text":"Samuel, can you review the patch?","id":3470564,"bug_id":350,"tags":[]},{"is_private":false,"creation_time":"Sun Jun 01 11:16:44 EEST 2008","creator":"dranger@gmail.com","author":"dranger@gmail.com","time":"Sun Jun 01 11:16:44 EEST 2008","text":"happy tenth anniversary!!","id":3643711,"bug_id":350,"tags":[]},{"is_private":false,"creation_time":"Sun Jun 01 12:22:39 EEST 2008","creator":"kaie@kuix.de","author":"kaie@kuix.de","time":"Sun Jun 01 12:22:39 EEST 2008","text":"It appears that Samuel has been unable to review this patch (yet).  It appears that nobody had time (yet) to work on the cosmetic changes that Nelson has proposed.  Nelson, Wan-Teh, as this is a patch with reviews, could it get checked in, despite the lack of the cosmetic change? ","id":3643743,"bug_id":350,"tags":[]},{"is_private":false,"creation_time":"Sat Feb 07 21:49:33 EET 2009","creator":"ryanvm@gmail.com","author":"ryanvm@gmail.com","attachment_id":361089,"time":"Sat Feb 07 21:49:33 EET 2009","text":"Created attachment 361089 v3: can handle any year from 1 to whatever  OK, I've updated the patch to take Nelson's comments into account. Regarding comment #1, I added a comment mentioning the need to convert numDays from being based on 1970 to being based on year 1. Regarding comment #2, I decided to just add an integer with a comment. I'm not a huge fan of magic numbers, but I don't want to mess with the prevailing style of the function.  I also added an unrelated whitespace fix that happened to catch my eye.  wtc, kaie, nelson, who should review this so we can get this in and close it out? Also, are tests needed for this somewhere? I don't know what protocol is for NSPR.","id":3963989,"bug_id":350,"tags":[]},{"is_private":false,"creation_time":"Sat Feb 07 23:39:55 EET 2009","creator":"ryanvm@gmail.com","author":"ryanvm@gmail.com","attachment_id":361098,"time":"Sat Feb 07 23:39:55 EET 2009","text":"Created attachment 361098 v3a: can handle any year from 1 to whatever  So, when trying to run this patch on the tryserver, I found out that both v2 and v3 were missing a semicolon, making the compilers rather angry. v3a fixes the missing semicolon.  Tryserver builds are available here: https://build.mozilla.org/tryserver-builds/2009-02-07_14:28-jdolske@mozilla.com-try-c0552e9f41c/  Could someone try these builds out to verify that the fix works as expected?","id":3964039,"bug_id":350,"tags":[]},{"is_private":false,"creation_time":"Sun Feb 08 23:02:42 EET 2009","creator":"nelson@bolyard.me","author":"nelson@bolyard.me","attachment_id":361184,"time":"Sun Feb 08 23:02:42 EET 2009","text":"Created attachment 361184 patch v3b - converted to CVS diff   To facilitate review, I converted this patch to a CVS diff. This is because a) the \"master\" upstream NSPR repository is CVS, and  b) bonsai's interdiff patch reader only works with CVS diffs (bug 386251).","id":3964757,"bug_id":350,"tags":[]},{"is_private":false,"creation_time":"Sun Feb 08 23:13:33 EET 2009","creator":"nelson@bolyard.me","author":"nelson@bolyard.me","attachment_id":361186,"time":"Sun Feb 08 23:13:33 EET 2009","text":"Created attachment 361186 patch v4 - remove resurrected code  Patch v3 appears to have resurrected some code that was correctly deleted  in v2.  Thus, my sr+ for v2 does not apply to v3.  That's one reason why we don't allow the practice of \"carrying forward\" r+/sr+ from old patches  to new ones for NSPR and NSS.    I think this patch fixes it again.  Will know soon.","id":3964768,"bug_id":350,"tags":[]},{"is_private":false,"creation_time":"Sun Feb 08 23:14:34 EET 2009","creator":"nelson@bolyard.me","author":"nelson@bolyard.me","attachment_id":361089,"time":"Sun Feb 08 23:14:34 EET 2009","text":"Comment on attachment 361089 v3: can handle any year from 1 to whatever  removing \"carried forward\" sr+.","id":3964770,"bug_id":350,"tags":[]},{"is_private":false,"creation_time":"Sun Feb 08 23:23:08 EET 2009","creator":"nelson@bolyard.me","author":"nelson@bolyard.me","attachment_id":361098,"time":"Sun Feb 08 23:23:08 EET 2009","text":"Comment on attachment 361098 v3a: can handle any year from 1 to whatever  removing \"carried forward\" sr+.","id":3964776,"bug_id":350,"tags":[]},{"is_private":false,"creation_time":"Sun Feb 08 23:24:37 EET 2009","creator":"ryanvm@gmail.com","author":"ryanvm@gmail.com","time":"Sun Feb 08 23:24:37 EET 2009","text":"Whoops, sorry about re-adding the code. v4 is missing a comment regarding 1461 days being a 4 year span, though, since I'd added it to the block being deleted. It should probably be added further down where 1461 first appears.","id":3964778,"bug_id":350,"tags":[]},{"is_private":false,"creation_time":"Sun Feb 08 23:26:51 EET 2009","creator":"nelson@bolyard.me","author":"nelson@bolyard.me","attachment_id":361186,"time":"Sun Feb 08 23:26:51 EET 2009","text":"Comment on attachment 361186 patch v4 - remove resurrected code  Since so many of us have now contributed to this patch, I'm going to ask someone who has not previously participated in this bug to review the latest diffs.    Julien, please review the diffs between v2 and v4 of this patch, using https://bugzilla.mozilla.org/attachment.cgi?oldid=279492&action=interdiff&newid=361186 (You are, of course, free to review the whole patch, if you wish.)","id":3964780,"bug_id":350,"tags":[]},{"is_private":false,"creation_time":"Sun Feb 08 23:31:46 EET 2009","creator":"nelson@bolyard.me","author":"nelson@bolyard.me","attachment_id":361188,"time":"Sun Feb 08 23:31:46 EET 2009","text":"Created attachment 361188 patch v5 - readd deleted comment  Thanks for catching the lost comment.  I readded it. Julien, please review this patch, comparing it to patch v2.   I will commit this if/when it gets r+ giving credit to all contributors.","id":3964784,"bug_id":350,"tags":[]},{"is_private":false,"creation_time":"Mon Feb 09 19:49:35 EET 2009","creator":"wtc@google.com","author":"wtc@google.com","attachment_id":361319,"time":"Mon Feb 09 19:49:35 EET 2009","text":"Created attachment 361319 patch v6 (checked in)  I checked in this patch on the NSPR trunk (NSPR 4.8).  Checking in prtime.c; /cvsroot/mozilla/nsprpub/pr/src/misc/prtime.c,v  <--  prtime.c new revision: 3.36; previous revision: 3.35 done  The comment \"We first do the usec, sec, min, hour thing so that we do not have to do LL arithmetic\" means that it is OK for numDays to be a PRInt32 and to be manipulated with 32-bit arithmetic.  Since the new code still has that property, I kept this comment.","id":3965881,"bug_id":350,"tags":[]},{"is_private":false,"creation_time":"Mon Feb 09 20:31:41 EET 2009","creator":"wtc@google.com","author":"wtc@google.com","attachment_id":361319,"time":"Mon Feb 09 20:31:41 EET 2009","text":"Comment on attachment 361319 patch v6 (checked in)  I just pushed a new NSPR snapshot (CVS tag NSPR_HEAD_20090209) with this patch to mozilla-central in changeset b21b71e9b0b1. http://hg.mozilla.org/mozilla-central/rev/b21b71e9b0b1","id":3965946,"bug_id":350,"tags":[]},{"is_private":false,"creation_time":"Wed Apr 08 02:36:40 EEST 2009","creator":"ssitter@gmail.com","author":"ssitter@gmail.com","time":"Wed Apr 08 02:36:40 EEST 2009","text":"Dependent bug 238632 seems to be fixed in Thunderbird 3.1a1pre (20090407) after this fix. Is it planned to make the fix available in mozilla-1.9.1 too for the upcoming Thunderbird 3.0 release?","id":4050603,"bug_id":350,"tags":[]},{"is_private":false,"creation_time":"Wed Apr 08 03:01:07 EEST 2009","creator":"wtc@google.com","author":"wtc@google.com","time":"Wed Apr 08 03:01:07 EEST 2009","text":"This is a very minor bug, so I don't plan to make the fix available in mozilla-1.9.1.","id":4050628,"bug_id":350,"tags":[]},{"is_private":false,"creation_time":"Fri May 15 05:40:36 EEST 2009","creator":"wtc@google.com","author":"wtc@google.com","time":"Fri May 15 05:40:36 EEST 2009","text":"(In reply to comment #34) Stefan, this fix is now in mozilla-1.9.1.","id":4099771,"bug_id":350,"tags":[]}]}
