{"bugs":[{"creation_time":"Sun Aug 02 14:00:00 EEST 1998","keywords":["4xp","css1"],"see_also":[],"resolution":"FIXED","cf_blocking_fx":"---","cf_fx_iteration":"---","cf_blocking_b2g":"---","cf_status_b2g_1_4":"---","id":588,"is_open":false,"cf_qa_whiteboard":"","assigned_to_detail":{"name":"roc@ocallahan.org","real_name":"Robert O'Callahan (:roc) (Mozilla Corporation)","id":5038,"email":"roc@ocallahan.org"},"creator_detail":{"name":"angus@formerly-netscape.com.tld","real_name":"Angus Davis","id":70,"email":"angus@formerly-netscape.com.tld"},"cf_status_firefox37":"---","priority":"P1","cf_status_firefox36":"---","classification":"Components","cf_status_firefox35":"---","version":"Trunk","cf_status_firefox34":"---","op_sys":"All","last_change_time":"Tue Jan 20 23:25:05 EET 2009","cf_crash_signature":"","mentors_detail":[],"cf_tracking_b2g":"---","qa_contact_detail":{"name":"christinehoff4@aol.com","real_name":"Christine Hoffman","id":4110,"email":"christinehoff4@aol.com"},"cf_status_b2g_2_0m":"---","status":"VERIFIED","cf_feature_b2g":"---","is_cc_accessible":true,"cf_tracking_firefox37":"---","cf_tracking_firefox36":"---","cf_tracking_relnote_b2g":"---","flags":[],"cf_status_firefox_esr31":"---","whiteboard":"","platform":"All","cf_tracking_firefox_esr31":"---","cf_blocking_fennec":"---","cf_fx_points":"---","cf_tracking_firefox35":"---","cf_tracking_firefox34":"---","cf_status_b2g_2_2":"---","cf_status_b2g_2_1":"---","cf_status_b2g_2_0":"---","assigned_to":"roc@ocallahan.org","summary":"{feature} [TEXT] Full justification of text doesn't work","cf_tracking_e10s":"---","cc":["arosewar@cs.rmit.edu.au","bugzilla2@sweeneymail.com","buster@formerly-netscape.com.tld","dbaron@dbaron.org","fantasai.bugs@inkedblade.net","ian@hixie.ch","karl@huftis.org","matty_is_a_geek@fastmail.fm","peterl-retired@formerly-netscape.com.tld","roc@ocallahan.org"],"severity":"normal","creator":"angus@formerly-netscape.com.tld","product":"Core","depends_on":[],"cf_tracking_firefox_relnote":"---","blocks":[],"is_confirmed":true,"groups":[],"cf_last_resolved":"Mon Apr 17 15:18:14 EEST 2000","url":"http://www.w3.org/Style/CSS/Test/current/sec546.htm","qa_contact":"christinehoff4@aol.com","target_milestone":"M16","component":"Layout","is_creator_accessible":true,"cc_detail":[{"name":"arosewar@cs.rmit.edu.au","real_name":"","id":8557,"email":"arosewar@cs.rmit.edu.au"},{"name":"bugzilla2@sweeneymail.com","real_name":"Phil \"clef\" Sweeney","id":4232,"email":"bugzilla2@sweeneymail.com"},{"name":"buster@formerly-netscape.com.tld","real_name":"","id":3829,"email":"buster@formerly-netscape.com.tld"},{"name":"dbaron@dbaron.org","real_name":"David Baron [:dbaron] (UTC-5) (needinfo? for questions)","id":3881,"email":"dbaron@dbaron.org"},{"name":"fantasai.bugs@inkedblade.net","real_name":"fantasai","id":9018,"email":"fantasai.bugs@inkedblade.net"},{"name":"ian@hixie.ch","real_name":"Hixie (not reading bugmail)","id":4054,"email":"ian@hixie.ch"},{"name":"karl@huftis.org","real_name":"Karl Ove 'I hate marquee' Hufthammer","id":6573,"email":"karl@huftis.org"},{"name":"matty_is_a_geek@fastmail.fm","real_name":"Matthew Tuck [:CodeMachine]","id":4412,"email":"matty_is_a_geek@fastmail.fm"},{"name":"peterl-retired@formerly-netscape.com.tld","real_name":"Peter Linss","id":3826,"email":"peterl-retired@formerly-netscape.com.tld"},{"name":"roc@ocallahan.org","real_name":"Robert O'Callahan (:roc) (Mozilla Corporation)","id":5038,"email":"roc@ocallahan.org"}],"mentors":[],"cf_user_story":""}],"comments":[{"is_private":false,"creation_time":"Sun Aug 02 14:00:00 EEST 1998","creator":"angus@formerly-netscape.com.tld","author":"angus@formerly-netscape.com.tld","time":"Sun Aug 02 14:00:00 EEST 1998","text":"We don't support justified text yet. Does this fit in with the whitespace work? It's also a style issue. See URL for test case and sample code.","id":1807,"bug_id":588,"tags":[]},{"is_private":false,"creation_time":"Tue Oct 27 19:32:59 EET 1998","creator":"kipp@formerly-netscape.com.tld","author":"kipp@formerly-netscape.com.tld","time":"Tue Oct 27 19:32:59 EET 1998","text":"It is now partially implemented, though it could use some work. I'm leaving the bug open, but at a reduced priority because there are some easy to create conditions where the justification fails to operate as expected.","id":1808,"bug_id":588,"tags":[]},{"is_private":false,"creation_time":"Tue Oct 27 19:42:59 EET 1998","creator":"kipp@formerly-netscape.com.tld","author":"kipp@formerly-netscape.com.tld","time":"Tue Oct 27 19:42:59 EET 1998","text":"*** Bug 1047 has been marked as a duplicate of this bug. ***","id":1809,"bug_id":588,"tags":[]},{"is_private":false,"creation_time":"Wed Feb 03 16:08:59 EET 1999","creator":"leger@formerly-netscape.com.tld","author":"leger@formerly-netscape.com.tld","time":"Wed Feb 03 16:08:59 EET 1999","text":"Setting all current Open/Normal to M4.","id":1810,"bug_id":588,"tags":[]},{"is_private":false,"creation_time":"Tue Feb 23 21:03:59 EET 1999","creator":"kipp@formerly-netscape.com.tld","author":"kipp@formerly-netscape.com.tld","time":"Tue Feb 23 21:03:59 EET 1999","text":"*** Bug 3222 has been marked as a duplicate of this bug. ***","id":1811,"bug_id":588,"tags":[]},{"is_private":false,"creation_time":"Tue Feb 23 22:29:59 EET 1999","creator":"dbaron@dbaron.org","author":"dbaron@dbaron.org","time":"Tue Feb 23 22:29:59 EET 1999","text":"The regression I reported in 3222 occurred between the builds of 99-02-11 and 99-02-16.","id":1812,"bug_id":588,"tags":[]},{"is_private":false,"creation_time":"Tue Mar 16 23:50:59 EET 1999","creator":"kipp@formerly-netscape.com.tld","author":"kipp@formerly-netscape.com.tld","time":"Tue Mar 16 23:50:59 EET 1999","text":"See also http://www.angelfire.com/ms/dhtml (bug #2475)","id":1813,"bug_id":588,"tags":[]},{"is_private":false,"creation_time":"Tue Mar 16 23:51:59 EET 1999","creator":"kipp@formerly-netscape.com.tld","author":"kipp@formerly-netscape.com.tld","time":"Tue Mar 16 23:51:59 EET 1999","text":"*** Bug 2475 has been marked as a duplicate of this bug. ***","id":1814,"bug_id":588,"tags":[]},{"is_private":false,"creation_time":"Tue Mar 16 23:52:59 EET 1999","creator":"kipp@formerly-netscape.com.tld","author":"kipp@formerly-netscape.com.tld","time":"Tue Mar 16 23:52:59 EET 1999","text":"See also http://rucs.rutgers.edu/emailtf.wp1.html (bug #1783)","id":1815,"bug_id":588,"tags":[]},{"is_private":false,"creation_time":"Tue Mar 16 23:52:59 EET 1999","creator":"kipp@formerly-netscape.com.tld","author":"kipp@formerly-netscape.com.tld","time":"Tue Mar 16 23:52:59 EET 1999","text":"*** Bug 1783 has been marked as a duplicate of this bug. ***","id":1816,"bug_id":588,"tags":[]},{"is_private":false,"creation_time":"Mon Mar 22 15:44:59 EET 1999","creator":"kipp@formerly-netscape.com.tld","author":"kipp@formerly-netscape.com.tld","time":"Mon Mar 22 15:44:59 EET 1999","text":"*** Bug 3923 has been marked as a duplicate of this bug. ***","id":1817,"bug_id":588,"tags":[]},{"is_private":false,"creation_time":"Wed Mar 24 02:56:59 EET 1999","creator":"kipp@formerly-netscape.com.tld","author":"kipp@formerly-netscape.com.tld","time":"Wed Mar 24 02:56:59 EET 1999","text":"*** Bug 3493 has been marked as a duplicate of this bug. ***","id":1818,"bug_id":588,"tags":[]},{"is_private":false,"creation_time":"Tue Mar 30 04:35:59 EEST 1999","creator":"kipp@formerly-netscape.com.tld","author":"kipp@formerly-netscape.com.tld","time":"Tue Mar 30 04:35:59 EEST 1999","text":"*** Bug 4397 has been marked as a duplicate of this bug. ***","id":1819,"bug_id":588,"tags":[]},{"is_private":false,"creation_time":"Tue Apr 06 22:23:59 EEST 1999","creator":"kipp@formerly-netscape.com.tld","author":"kipp@formerly-netscape.com.tld","time":"Tue Apr 06 22:23:59 EEST 1999","text":"*** Bug 4447 has been marked as a duplicate of this bug. ***","id":1820,"bug_id":588,"tags":[]},{"is_private":false,"creation_time":"Tue Apr 06 22:28:59 EEST 1999","creator":"cpratt@formerly-netscape.com.tld","author":"cpratt@formerly-netscape.com.tld","time":"Tue Apr 06 22:28:59 EEST 1999","text":"See also http://schist/4447.html","id":1821,"bug_id":588,"tags":[]},{"is_private":false,"creation_time":"Tue Apr 13 02:26:59 EEST 1999","creator":"troy@formerly-netscape.com.tld","author":"troy@formerly-netscape.com.tld","time":"Tue Apr 13 02:26:59 EEST 1999","text":"*** Bug 5017 has been marked as a duplicate of this bug. ***","id":1822,"bug_id":588,"tags":[]},{"is_private":false,"creation_time":"Tue May 18 14:56:59 EEST 1999","creator":"ian@hixie.ch","author":"ian@hixie.ch","time":"Tue May 18 14:56:59 EEST 1999","text":"Increasing priority a little because this is a CSS1 issue and there are some CSS2 issues at enhancement/P5.  The interaction of text-align:justify and white-space:pre is covered by bug 6011.","id":1823,"bug_id":588,"tags":[]},{"is_private":false,"creation_time":"Fri Jul 30 05:37:59 EEST 1999","creator":"run2000@geocities.com","author":"run2000@geocities.com","time":"Fri Jul 30 05:37:59 EEST 1999","text":"*** Bug 10798 has been marked as a duplicate of this bug. ***","id":1824,"bug_id":588,"tags":[]},{"is_private":false,"creation_time":"Sun Sep 19 16:49:59 EEST 1999","creator":"mats@mozilla.com","author":"mats@mozilla.com","time":"Sun Sep 19 16:49:59 EEST 1999","text":"*** Bug 14279 has been marked as a duplicate of this bug. ***","id":1825,"bug_id":588,"tags":[]},{"is_private":false,"creation_time":"Thu Nov 18 13:06:59 EET 1999","creator":"bugzilla2@sweeneymail.com","author":"bugzilla2@sweeneymail.com","time":"Thu Nov 18 13:06:59 EET 1999","text":"*** Bug 19195 has been marked as a duplicate of this bug. ***","id":1826,"bug_id":588,"tags":[]},{"is_private":false,"creation_time":"Mon Nov 29 23:12:59 EET 1999","creator":"dr@cs.brown.edu","author":"dr@cs.brown.edu","time":"Mon Nov 29 23:12:59 EET 1999","text":"A simple testcase (also demonstrating bug 20260) is at http://www.thirdnipple.com/mozilla/.  This also occurs without the table in this page, but I didn't feel like typing a whole screen's worth of filler text :) I'd suggest that this is a problem which ought to be fixed before beta, as a lot of websites rely on full justification to look nice... The priority IMHO ought to be higher, but I'll leave that to the people who know this bug better.","id":1827,"bug_id":588,"tags":[]},{"is_private":false,"creation_time":"Fri Dec 03 18:37:59 EET 1999","creator":"mats@mozilla.com","author":"mats@mozilla.com","time":"Fri Dec 03 18:37:59 EET 1999","text":"*** Bug 20703 has been marked as a duplicate of this bug. ***","id":1828,"bug_id":588,"tags":[]},{"is_private":false,"creation_time":"Fri Dec 03 20:09:59 EET 1999","creator":"pierre@formerly-netscape.com.tld","author":"pierre@formerly-netscape.com.tld","time":"Fri Dec 03 20:09:59 EET 1999","text":"*** Bug 20571 has been marked as a duplicate of this bug. ***","id":1829,"bug_id":588,"tags":[]},{"is_private":false,"creation_time":"Tue Dec 14 21:50:59 EET 1999","creator":"leger@formerly-netscape.com.tld","author":"leger@formerly-netscape.com.tld","time":"Tue Dec 14 21:50:59 EET 1999","text":"Updating to default Style System Assignee...kipp no longer with us :-(","id":1830,"bug_id":588,"tags":[]},{"is_private":false,"creation_time":"Thu Jan 13 23:59:59 EET 2000","creator":"ian@hixie.ch","author":"ian@hixie.ch","time":"Thu Jan 13 23:59:59 EET 2000","text":"Migrating from {css1} to css1 keyword. The {css1}, {css2}, {css3} and {css-moz} radars should now be considered deprecated in favour of keywords. I am *really* sorry about the spam...","id":1831,"bug_id":588,"tags":[]},{"is_private":false,"creation_time":"Mon Jan 24 10:35:21 EET 2000","creator":"adam@gimp.org","author":"adam@gimp.org","time":"Mon Jan 24 10:35:21 EET 2000","text":"Assigned to kipp so that this hopefully doesn't get overlooked for much longer by the new layout kings. ","id":171073,"bug_id":588,"tags":[]},{"is_private":false,"creation_time":"Tue Jan 25 18:18:54 EET 2000","creator":"buster@formerly-netscape.com.tld","author":"buster@formerly-netscape.com.tld","time":"Tue Jan 25 18:18:54 EET 2000","text":"based on the number of pages effected, the comments in this bug, and follow-up  comments on the newsgroup, maing this P1.","id":172325,"bug_id":588,"tags":[]},{"is_private":false,"creation_time":"Fri Jan 28 18:49:48 EET 2000","creator":"leger@formerly-netscape.com.tld","author":"leger@formerly-netscape.com.tld","time":"Fri Jan 28 18:49:48 EET 2000","text":"Setting the keyword all open [4.xp] bugs to 4xp.","id":176146,"bug_id":588,"tags":[]},{"is_private":false,"creation_time":"Mon Jan 31 01:31:48 EET 2000","creator":"mats@mozilla.com","author":"mats@mozilla.com","time":"Mon Jan 31 01:31:48 EET 2000","text":"*** Bug 25803 has been marked as a duplicate of this bug. ***","id":177931,"bug_id":588,"tags":[]},{"is_private":false,"creation_time":"Wed Feb 02 23:00:40 EET 2000","creator":"christinehoff4@aol.com","author":"christinehoff4@aol.com","time":"Wed Feb 02 23:00:40 EET 2000","text":"*** Bug 26287 has been marked as a duplicate of this bug. ***","id":182314,"bug_id":588,"tags":[]},{"is_private":false,"creation_time":"Thu Feb 03 19:57:10 EET 2000","creator":"christinehoff4@aol.com","author":"christinehoff4@aol.com","time":"Thu Feb 03 19:57:10 EET 2000","text":"Adding 'beta1' to keywords. Beta1 should support all CSS1 styles. ","id":183512,"bug_id":588,"tags":[]},{"is_private":false,"creation_time":"Fri Feb 04 01:34:57 EET 2000","creator":"leger@formerly-netscape.com.tld","author":"leger@formerly-netscape.com.tld","time":"Fri Feb 04 01:34:57 EET 2000","text":"Putting on PDT+ radar for beta1.","id":184180,"bug_id":588,"tags":[]},{"is_private":false,"creation_time":"Wed Feb 09 16:53:09 EET 2000","creator":"buster@formerly-netscape.com.tld","author":"buster@formerly-netscape.com.tld","time":"Wed Feb 09 16:53:09 EET 2000","text":"this is likely to be very hard.","id":189830,"bug_id":588,"tags":[]},{"is_private":false,"creation_time":"Wed Feb 09 17:51:43 EET 2000","creator":"dbaron@dbaron.org","author":"dbaron@dbaron.org","time":"Wed Feb 09 17:51:43 EET 2000","text":"This used to work (somewhat buggily) about a year ago, so the code is there, somewhere.  It stopped working correctly in March 1999 and then I think Kipp disabled it.  It may also have had i18n problems.","id":189890,"bug_id":588,"tags":[]},{"is_private":false,"creation_time":"Wed Feb 09 19:45:40 EET 2000","creator":"dr@cs.brown.edu","author":"dr@cs.brown.edu","time":"Wed Feb 09 19:45:40 EET 2000","text":"Give it to Knuth! Knuth will code anything!","id":190080,"bug_id":588,"tags":[]},{"is_private":false,"creation_time":"Fri Feb 11 00:24:07 EET 2000","creator":"nisheeth_mozilla@yahoo.com","author":"nisheeth_mozilla@yahoo.com","time":"Fri Feb 11 00:24:07 EET 2000","text":"I looked at this today.  There is some code in the block frame that figures out  whether a line can be fully justified and passes that boolean to  nsLineLayout::HorizontalAlignFrames().  This code was ifdefed out and I  re-enabled it in my build.  Even with this enabled, though, text does not get  fully justified because HorizontalAlignFrames() doesn't do anything for that  case.  I'm attaching a really simple test case which has a single line of fully  justified text.  Since I can't find any code that tries to fully justify text, implementing it  will take some time.  This is definitely not possible for M14.  Updating status  whiteboard to indicate as such.","id":191958,"bug_id":588,"tags":[]},{"is_private":false,"creation_time":"Fri Feb 11 00:31:00 EET 2000","creator":"nisheeth_mozilla@yahoo.com","author":"nisheeth_mozilla@yahoo.com","attachment_id":5145,"time":"Fri Feb 11 00:31:00 EET 2000","text":"Created attachment 5145 Simple fully justified text test case","id":191972,"bug_id":588,"tags":[]},{"is_private":false,"creation_time":"Fri Feb 11 03:25:32 EET 2000","creator":"sdm@pobox.com","author":"sdm@pobox.com","time":"Fri Feb 11 03:25:32 EET 2000","text":"Here is Kipp's initial justify work: http://bonsai.mozilla.org/cvsquery.cgi?treeid=default&module=SeaMonkeyAll&branch=HEAD&branchtype=match&dir=&file=&filetype=match&who=kipp*&whotype=regexp&sortby=Date&hours=2&date=explicit&mindate=10%2F25%2F1998+00%3A00%3A00&maxdate=10%2F27%2F1998+09%3A00%3A00&cvsroot=%2Fcvsroot  It seemed to involve calculating a special wordspacing, and adding the extra space to the whitespace glyph width. There was also a JustifyFrames method that took care of this, but, that was probably replaced by nsInlineFrame::AdjustFrameSize","id":192478,"bug_id":588,"tags":[]},{"is_private":false,"creation_time":"Fri Feb 11 22:49:05 EET 2000","creator":"dbaron@dbaron.org","author":"dbaron@dbaron.org","time":"Fri Feb 11 22:49:05 EET 2000","text":"A good place to start would probably be enabling the disabled code in nsBlockFrame::PlaceLine, and seeing what happens.","id":193337,"bug_id":588,"tags":[]},{"is_private":false,"creation_time":"Tue Feb 15 22:56:49 EET 2000","creator":"troy@formerly-netscape.com.tld","author":"troy@formerly-netscape.com.tld","time":"Tue Feb 15 22:56:49 EET 2000","text":"Removing PDT+ and beta1 keyword, because this work cannot be done for M14. We  also think it's not required for beta 1 that we support full justification","id":197686,"bug_id":588,"tags":[]},{"is_private":false,"creation_time":"Sat Mar 04 00:06:24 EET 2000","creator":"buster@formerly-netscape.com.tld","author":"buster@formerly-netscape.com.tld","time":"Sat Mar 04 00:06:24 EET 2000","text":"mine! mine mine mine!  all mine!  whoo-hoo!","id":218590,"bug_id":588,"tags":[]},{"is_private":false,"creation_time":"Tue Mar 07 21:41:40 EET 2000","creator":"dbaron@dbaron.org","author":"dbaron@dbaron.org","time":"Tue Mar 07 21:41:40 EET 2000","text":"Note that the justification algorithm should handle the properities word-spacing, letter-spacing, and white-space (and probably others...).","id":222469,"bug_id":588,"tags":[]},{"is_private":false,"creation_time":"Thu Mar 09 00:12:32 EET 2000","creator":"rzach@ucalgary.ca","author":"rzach@ucalgary.ca","time":"Thu Mar 09 00:12:32 EET 2000","text":"*** Bug 31056 has been marked as a duplicate of this bug. ***","id":224635,"bug_id":588,"tags":[]},{"is_private":false,"creation_time":"Wed Mar 15 15:05:48 EET 2000","creator":"troy@formerly-netscape.com.tld","author":"troy@formerly-netscape.com.tld","time":"Wed Mar 15 15:05:48 EET 2000","text":"*** Bug 31920 has been marked as a duplicate of this bug. ***","id":231500,"bug_id":588,"tags":[]},{"is_private":false,"creation_time":"Sun Mar 19 01:55:16 EET 2000","creator":"fantasai.bugs@inkedblade.net","author":"fantasai.bugs@inkedblade.net","time":"Sun Mar 19 01:55:16 EET 2000","text":"I've done some work on this, and I'm ready to try testing it. However, I don't  have a compiler. If anyone wants to take a look, I've uploaded a copy here:  http://fantasai.tripod.com/Mozilla/TXJ/  So, if anyone gets this to compile, please tell me what happens?  I'm rather curious to know what it will do.","id":235610,"bug_id":588,"tags":[]},{"is_private":false,"creation_time":"Thu Apr 06 04:54:35 EEST 2000","creator":"joshua1.9@prodigy.net","author":"joshua1.9@prodigy.net","time":"Thu Apr 06 04:54:35 EEST 2000","text":"*** Bug 34764 has been marked as a duplicate of this bug. ***","id":254135,"bug_id":588,"tags":[]},{"is_private":false,"creation_time":"Fri Apr 07 23:40:49 EEST 2000","creator":"rickg@formerly-netscape.com.tld","author":"rickg@formerly-netscape.com.tld","time":"Fri Apr 07 23:40:49 EEST 2000","text":"moving all buster m15 bugs to m16.","id":256680,"bug_id":588,"tags":[]},{"is_private":false,"creation_time":"Wed Apr 12 06:29:52 EEST 2000","creator":"roc@ocallahan.org","author":"roc@ocallahan.org","time":"Wed Apr 12 06:29:52 EEST 2000","text":"I have implemented this. I will attach the patch momentarily.  I got a few ideas from fantasai's patch (thanks!) but mine is rather different. In particular, I've avoided adding any fields to nsTextFrame or any of the style contexts. The basic idea is that nsLineLayout collects information from the text frames during reflow; in particular it collects the number of spaces in each text frame. It then uses this in HorizontalAlignFrames to distribute leftover line space appropriately to each text frame. Justified text frames notice when they are bigger than they need to be and distribute the extra space internally in the correct manner.  There are probably some bugs. In fact, I found and fixed a number of other bugs while I was doing this; they are marked \"NOTE:\" in the patch.  Regarding PRE: I treat nonbreaking spaces (which is what all PRE spaces turn into) as regular spaces for the purposes of justification. Spaces derived from tab expansion are also treated the same way. I don't know if this is \"correct\" or not, but it works in that it makes justification useful in the context of PRE.  Word-spacing and letter-spacing work. It all even works in Composer (modulo a few display glitches). ","id":260773,"bug_id":588,"tags":[]},{"is_private":false,"creation_time":"Wed Apr 12 06:34:04 EEST 2000","creator":"roc@ocallahan.org","author":"roc@ocallahan.org","attachment_id":7504,"time":"Wed Apr 12 06:34:04 EEST 2000","text":"Created attachment 7504 Implementation of text justification","id":260778,"bug_id":588,"tags":[]},{"is_private":false,"creation_time":"Wed Apr 12 06:36:27 EEST 2000","creator":"roc@ocallahan.org","author":"roc@ocallahan.org","attachment_id":7505,"time":"Wed Apr 12 06:36:27 EEST 2000","text":"Created attachment 7505 A hacked-up test case that exercises spacing and PRE with justification","id":260782,"bug_id":588,"tags":[]},{"is_private":false,"creation_time":"Wed Apr 12 11:37:22 EEST 2000","creator":"dbaron@dbaron.org","author":"dbaron@dbaron.org","time":"Wed Apr 12 11:37:22 EEST 2000","text":"I have to say I don't think justification should do anything for PRE, since the lines in PRE are broken by forced breaks, and forced breaks are not justified.","id":260864,"bug_id":588,"tags":[]},{"is_private":false,"creation_time":"Wed Apr 12 16:48:03 EEST 2000","creator":"roc@ocallahan.org","author":"roc@ocallahan.org","time":"Wed Apr 12 16:48:03 EEST 2000","text":"Turning off justification for preformatted text is as simple as making  mJustifying depend on !mPreformatted, a one-line change to  TextStyle::TextStyle(). Then such text frames will not report any spaces or  letters to nsLineLayout, and will receive no extra space for justification.  One other thing I should mention --- single-word lines are currently not  justified in any way. My patch prepares the way for using letter-spacing to  stretch such words across the line, but I haven't actually put it in, because I  think it looks ugly.","id":260984,"bug_id":588,"tags":[]},{"is_private":false,"creation_time":"Wed Apr 12 20:51:16 EEST 2000","creator":"fantasai.bugs@inkedblade.net","author":"fantasai.bugs@inkedblade.net","time":"Wed Apr 12 20:51:16 EEST 2000","text":"You're quite welcome! I'm glad it helped, at least. Can't really expect one's  first C++ code to be perfect. ^o^ Actually, I still don't even know if mine  works or not. -_-;;  I thought of giving Line Layout the number of spaces and characters during  reflow, but I figured, why waste function calls when most text isn't justified  anyway? Maybe that's an invalid argument. I wouldn't know.   --Preformatted text can be justified if it's wrapped (-moz-pre-wrap).  --If the author wishes to suppress character-spacing justification, they can  simply specify 'letter-spacing: 0'. According to the CSS spec, the UA may only  adjust the letter-spacing if it is set to 'normal' (the default).  --Single word lines (when 'letter-spacing' is set even if extending  character-spacing is implemented) and lines without text need to be right  justified if the text direction is rtl.   Oh, and you really should take up word-spacing issues in bug 1046. :)  um.. Did the priority change or is it just my imagination?","id":261283,"bug_id":588,"tags":[]},{"is_private":false,"creation_time":"Wed Apr 12 22:21:49 EEST 2000","creator":"roc@ocallahan.org","author":"roc@ocallahan.org","time":"Wed Apr 12 22:21:49 EEST 2000","text":"> I thought of giving Line Layout the number of spaces and characters during > reflow, but I figured, why waste function calls when most text isn't justified > anyway?  The impact of that is minimal. There should be basically no impact on the  performance of laying out non-justified text. Laying out justified text is  slower than normal text. It could be sped up a little by caching the value of  each text frame's \"justifcation extra space\" somewhere, but that would require  significant additional space (if you put it in nsTextFrame) or complexity (if  you put it in an extension record in nsLineBox) --- not worth it in my opinion.  > --Preformatted text can be justified if it's wrapped (-moz-pre-wrap).  Is there a consensus on whether this should be justified? What's it used for?  It's easy to tweak the patch to handle these cases in whichever way is desired.  RTL support is a good point. It's probably broken. How can I test that? There  seem to be a lot of lurking RTL problems in this area, I'd rather not be the one  to have to fix them all.  Browsing around, I have noticed that some sites look bad because the existing  ShouldJustifyLine code is inadequate. E.g. <p>Hello kitty<br> gets justified. We can address that issue separately.  This bug has been P1 for a while, which is why I'm here.","id":261386,"bug_id":588,"tags":[]},{"is_private":false,"creation_time":"Thu Apr 13 00:00:04 EEST 2000","creator":"fantasai.bugs@inkedblade.net","author":"fantasai.bugs@inkedblade.net","time":"Thu Apr 13 00:00:04 EEST 2000","text":"-moz-pre-wrap is used for <PRE width=\"x\">. It keeps whitespace intact, but  allows wrapping. I don't see any reason why it shouldn't be justified, if full  justification was specified on it.   As for RTL.. your ApplyFrameJustification returns an nscoord value. Subtract  this from remainingWidth and delete the 'else' before the RTL check. I did the  same thing in mine--see the code under \"// Apply Justification\" in txj.txt.   I didn't see any record for a priority change, so I was wondering..","id":261544,"bug_id":588,"tags":[]},{"is_private":false,"creation_time":"Thu Apr 13 00:34:41 EEST 2000","creator":"dbaron@dbaron.org","author":"dbaron@dbaron.org","time":"Thu Apr 13 00:34:41 EEST 2000","text":"If you're going to allow justify on PRE elements, I think you should probably add a rule to ua.css so that PRE can't inherit 'text-align: justify', but it would have to be specified explicitly.  I think generally justify goes against the meaning of PRE.","id":261591,"bug_id":588,"tags":[]},{"is_private":false,"creation_time":"Thu Apr 13 18:21:12 EEST 2000","creator":"roc@ocallahan.org","author":"roc@ocallahan.org","time":"Thu Apr 13 18:21:12 EEST 2000","text":"I have updated the patch. It fixes the bug with BR-terminated lines; they are no  longer justified. I have disabled justification for PRE and -moz-pre-wrap text;  you can easily see where to turn this on again if desired. I have also brought  the patch up to date with the tip. I also fixed an existing bug in nsTextFrame  in the \"MeasureTextRuns\" code for Win32, where some lines were not being  correctly wrapped. All the examples I've looked at, including all the examples  from the duplicates of this bug, are looking good.  I tried some RTL tests, but the existing RTL handling already has bugs and it's  hard to tell whether I've introduced any new ones.  I decided not to justify -moz-pre-wrapped. The reason is that trailing  whitespace is not stripped from -moz-pre-wrapped text, so wrapped lines almost  always have a trailing space. This means that justification will not produce a  straight right margin. You could argue for stripping trailing whitespace from  -moz-pre-wrapped text, but that's a separate issue.","id":262556,"bug_id":588,"tags":[]},{"is_private":false,"creation_time":"Thu Apr 13 18:35:02 EEST 2000","creator":"roc@ocallahan.org","author":"roc@ocallahan.org","attachment_id":7552,"time":"Thu Apr 13 18:35:02 EEST 2000","text":"Created attachment 7552 Patch for justification support + assorted bugfixes, version 2","id":262577,"bug_id":588,"tags":[]},{"is_private":false,"creation_time":"Thu Apr 13 19:58:59 EEST 2000","creator":"buster@formerly-netscape.com.tld","author":"buster@formerly-netscape.com.tld","time":"Thu Apr 13 19:58:59 EEST 2000","text":"Robert:  On first review, your new patch looks great.  I'll spend some time  reviewing it in greater detail this afternoon.  If all looks good, I'll check it  in early tomorrow morning.  Or, would you rather have the honors?  Makes no  difference to me. Do you have cvs access rights?  If I do the checkin, it's  slightly easier for me because I can merge your changes with my own for 12+  other bugs I've been holding and get it all in at once.  Many thanks to fantasia for the first cut, and as always to david for his  insights.","id":262668,"bug_id":588,"tags":[]},{"is_private":false,"creation_time":"Thu Apr 13 20:28:52 EEST 2000","creator":"roc@ocallahan.org","author":"roc@ocallahan.org","time":"Thu Apr 13 20:28:52 EEST 2000","text":"I don't have CVS access, so you'll have to check it in.","id":262713,"bug_id":588,"tags":[]},{"is_private":false,"creation_time":"Thu Apr 13 20:49:03 EEST 2000","creator":"buster@formerly-netscape.com.tld","author":"buster@formerly-netscape.com.tld","time":"Thu Apr 13 20:49:03 EEST 2000","text":"I've done a thorough read-through, and it all looks great.  The only additions I  plan on making are a few comments, a few assertions (checking for null pointers  passed into new methods), and some cosmetic changes to bring it up to our coding  standard (method arguments take the form \"aArgName\".)  In a second pass, it would be better if the justification-specific data items  (mTextJustificationNumSpaces, etc.) were off in their own struct, and that  struct was dynamically allocated only when needed.  This would save us 16 bytes  per PerFrameData object in the case where justification isn't needed.  We can  look into that as an optimization later.  similarly, I've already moved all the  booleans in that data structure into a single PRInt32 bitfield, so I'll just  go ahead and do the same for mIsBullet now.  I'll run some tests, and if it all is well and if the tree is in good shape  tomorrow early am PST, it'll be in tomorrow's build.","id":262736,"bug_id":588,"tags":[]},{"is_private":false,"creation_time":"Thu Apr 13 21:32:09 EEST 2000","creator":"roc@ocallahan.org","author":"roc@ocallahan.org","time":"Thu Apr 13 21:32:09 EEST 2000","text":"> method arguments take the form \"aArgName\"  Oops, thanks for reminding me.  I didn't realize the size of PerFrameData was important. They only exist while  their line is being reflowed, right? Actually, those fields are costing 8 bytes  per PerFrameData, and 8 bytes per nsLineLayout. (So having a dynamic structure  within PerFrameData would only save 4 bytes for the non-justifying case.) It  probably wouldn't be too hard to get to 0 bytes per PerFrameData and 16 bytes  per nsLineLayout, by getting rid of ComputeJustificationWeights and keeping  running totals of the total space and letter counts in nsLineLayout::PlaceFrame.  Alternatively, I could get rid of all the space overhead if I could just call a  method in nsTextFrame to fetch the space and letter counts during  ComputeJustificationWeights, but I'm not sure how to do the cast in a totally  safe way.","id":262821,"bug_id":588,"tags":[]},{"is_private":false,"creation_time":"Thu Apr 13 21:51:09 EEST 2000","creator":"roc@ocallahan.org","author":"roc@ocallahan.org","time":"Thu Apr 13 21:51:09 EEST 2000","text":"At some point, now that nsIFrame::AdjustFrameSize isn't going to be used, it  should be deleted.  For optimization purposes, maybe we could add a method to nsIFrame that  retrieves space and letter counts. The default implementation would return 0s,  and nsTextFrame would override with the snippet that I added to  nsTextFrame::Reflow. This would be called during the ComputeJustificationWeights  traversal, and nothing would need to be recorded in the PerFrameData --- zero  space overhead. It would also get rid of the need to correct overestimated space  counts after whitespae trimming, because whitespace would already be trimmed by  the time we compute the counts.  I'll try this out once the basic patch is in.","id":262855,"bug_id":588,"tags":[]},{"is_private":false,"creation_time":"Fri Apr 14 23:17:51 EEST 2000","creator":"buster@formerly-netscape.com.tld","author":"buster@formerly-netscape.com.tld","time":"Fri Apr 14 23:17:51 EEST 2000","text":"Most tests passed perfectly.  But I had to make a small change to your logic to  get mail to run correctly.  I don't fully understand this, because the way you  had the code looked fine. Basically, I had to revert a change you made, as shown  below.  There are two adjacent code snippets marked with comments starting with O'Callahan XXX:         for (lastSegment = 0; textRun.mBreaks[lastSegment] < numCharsFit;  lastSegment++) ;       NS_ASSERTION(lastSegment < textRun.mNumSegments, \"failed to find  segment\");       // now we have textRun.mBreaks[lastSegment] >= numCharsFit       /* O'Callahan XXX: This snippet together with the snippet below prevents  mail from loading          Justification seems to work just fine without these changes.          We get into trouble in a case where lastSegment gets set to -1        if (textRun.mBreaks[lastSegment] > numCharsFit) {         // NOTE: this segment did not actually fit!         lastSegment--;       }       */     }      /* O'Callahan XXX: This snippet together with the snippet above prevents  mail from loading      if (lastSegment < 0) {               // no segments fit       break;     } else */     if (lastSegment == 0) {       // Only one segment fit       prevColumn = column;       prevOffset = aTextData.mOffset;     } else {   I plan on checking it in this way because it passes all my tests, plus the  justification works fine.  Maybe you could spend a little time figuring out why  your code creates some bad state that triggers an assertion in nsBlockFrame:      NS_ASSERTION(aState.IsImpactedByFloater(),                  \"redo line on totally empty line\");","id":263972,"bug_id":588,"tags":[]},{"is_private":false,"creation_time":"Sat Apr 15 03:41:58 EEST 2000","creator":"roc@ocallahan.org","author":"roc@ocallahan.org","time":"Sat Apr 15 03:41:58 EEST 2000","text":"OK. I made that change to resolve a rather obscure bug that I believe is exposed  by (rather than caused by) justification. Assuming I can reproduce it after  justification lands, I will file a separate bug and try to resolve the  situation.  The bug involves some lines not being broken correctly. Basically, the Win32  GetWidth using textRun will occasionally return a numCharsFit that is in the  middle of a word. MeasureText simply can't handle that; it computes a value for  \"lastSegment\" where the end of the line actually falls somewhere inside the  segment, and then assumes that all the text in lastSegment will actually fit on  the line, which is wrong. My changes simply try to do the right thing in this  case.","id":264209,"bug_id":588,"tags":[]},{"is_private":false,"creation_time":"Mon Apr 17 15:18:14 EEST 2000","creator":"buster@formerly-netscape.com.tld","author":"buster@formerly-netscape.com.tld","time":"Mon Apr 17 15:18:14 EEST 2000","text":"fix checked in for Robert O'Callahan <roc+moz@cs.cmu.edu>.  Should be able to  verify against 4/17/00 build.","id":265193,"bug_id":588,"tags":[]},{"is_private":false,"creation_time":"Mon Apr 17 18:15:01 EEST 2000","creator":"roc@ocallahan.org","author":"roc@ocallahan.org","time":"Mon Apr 17 18:15:01 EEST 2000","text":"Looks good in 2000041708.  I can't reproduce the GetWidth-related bug I was seeing. Let's forget about it for now :-).  I will file a bug regarding the excessive space consumption, and provide a patch when I get around to it.  I will also file a bug regarding the minor display glitches in Composer. It is probably a layout problem and might come up in non-Composer contexts (dynamic content). ","id":265453,"bug_id":588,"tags":[]},{"is_private":false,"creation_time":"Mon Apr 24 18:16:36 EEST 2000","creator":"christinehoff4@aol.com","author":"christinehoff4@aol.com","time":"Mon Apr 24 18:16:36 EEST 2000","text":"Tested on Windows, Mac and Linux. Windows and Linux work fine but justification  on Mac is buggy. Separate bug written up for that. Verifying this bug fixed.","id":272039,"bug_id":588,"tags":[]}]}
